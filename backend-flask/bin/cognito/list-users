#! /usr/bin/bash

import boto3
import os
import json

userpool_id = os.getenv("AWS_COGNITO_USER_POOL_ID")
client = boto3.client('cognito-idp')
params = {
    'UserPoolId' : userpool_id,
    'AttributesToGet' : [
        'preferred_username',
        'sub'
    ]
}

response = cient.list_users(**params)
uers = response['Users']

print(json.dumps(uers,sort_keys=True,indednt=2, default=str))

dict_users={}

for user in users:
    attrs = user['Attributes']
    sub = next((a for a in attrs if a["Name"]=='sub'),None)
    handle = next((a for a in attrs if a["Name"]=='preferred_username'),None)
    dict_users[handle['Value']] = sub['Value']

print(dict_users)
